
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Спастись на 8 марта</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script> 
    <link rel="stylesheet" href="main.css">      
</head>
<body>

<audio loop id="audioMain">
    <source src="music/main_theme_8_save.mp3" type="audio/mpeg">    
    Проигрывание музыки не поддерживается.
</audio>

<audio loop id="audioWin">
    <source src="music/win.mp3" type="audio/mpeg">    
    Проигрывание музыки не поддерживается.
</audio>

<audio loop id="audioTenQuestion">
    <source src="music/239084_10_question.mp3" type="audio/mpeg">    
    Проигрывание музыки не поддерживается.
</audio>



<!-- Блок для портретной ориентации -->
<div id="portrait-container" class="portrait-mode">
    <div>
        <button id="toggle-button">Изменить ориентацию</button>
    </div>
    
    <div id = "start-screen-id" class="start-screen">
        <div>        
            <div class="image-start-screen" style="margin-top: 350px;">            
                <img src="pic/game_title.png" alt="game_title_pic">
            </div>                       
            <div class="modal-footer" style="margin-top: 20px;">            
                <button id="show-rules" class="button-common button-common-327">Читать правила</button>      
            </div>       
            <div class="modal-footer" style="margin-top: 20px;">            
                <button id="start-game" class="button-common button-common-rules">Продолжить</button>      
            </div>
        </div>   
    </div>

    <div id = "rules-screen-id" class="rules-screen">
        <div>       
            <div class="rules-screen-body">            
                <div class="title_32_circe_extra_bold_brown_allcaps">Правила игры</div>                    
                <div>8 марта – это день, когда все должно быть идеально. Но семья думает иначе!</div>
                <div>
                <b>Твоя задача:</b> продержаться 1 минуту и не поддаться на бытовые провокации.<br>
                <b>Как играть:</b> Уворачивайся от домочадцев и их просьб, вовремя прыгая через них <br>
                <b>Твоя цель:</b> Сохранить спокойствие и время для себя.<br>
                <b>Помощь:</b> Если станет совсем тяжко – жми на кнопку «Уехать на шопинг», это даст тебе 5 секунд тишины.<br>
                <b>Приз:</b> Победишь – получишь заслуженный релакс и подарок от Суши Мастер!</div>
            </div>        
            <div class="modal-footer" style="margin-top: 20px;">            
                <button id="start-game2" class="button-common button-common-rules">Продолжить</button>      
            </div>
        </div>   
    </div>

</div>
    
<!-- Блок для альбомной ориентации -->
<div id="landscape-container" class="landscape-mode hidden">
    <div>
        <button id="toggle-button">Изменить ориентацию</button>
    </div>

    <div id = "turn_screen_id" class="game-screen game-screen-turn">
         <div class="modal-footer" style="margin-top: 260px;">            
                <button id="continue-game" class="button-common button-common-rules">Старт</button>      
            </div>        
    </div>

    <div id="game_screen_id" class="game-screen">
        <div class="top_bar_conteiner">
            <div class="timer-body">
                <div class="timer-text" id="timer">0</div>
            </div>
            <div>
                <button id="music-off" class="music-button">
                    <img src="pic/sound_on.png" alt="turn_sound_pic">
                </button>
            </div>
        </div>

        <div id="enemy_id" class="enemy-conteiner">
            <img id="enemy_pic_id" src="pic/man.png" alt="enemy_pic">
        </div>
        
        <div id="hero_id" class="hero-conteiner">
            <img src="pic/wife_stay.png" alt="hero_pic">
        </div>

        <div class="bottom_bar_conteiner">
            <div style="margin-top: 20px;">
                <button id="shopping_button_id" class="button-common button-common-280-red button-common-280-green">Поехать на шопинг</button>
            </div>
            <div>
                <button id="jump_button_id" class="music-button">
                    <img src="pic/jump.png" alt="jump_pic">
                </button>
            </div>
        </div>
    </div>

    <div id="сongratulations-dialogue" class="game-screen game-screen-win">

        <div>               
            <div class="button-right">
                <div class="lose-screen-body win-screen-body">
                    <p> Всё получилось. Ты - настоящая супергероиня праздника!</p>
                </div>                
            </div>        
            
            <div class="button-right">            
                <button id="exit-game-win" class="button-common button-common-280-red button-common-280-green">Забрать промокод</button>            
            </div>
        </div> 
       
    </div>
    
    <div id="losegame" class="game-screen game-screen-lose">
        <div>               
            <div class="button-right">
                <div class="lose-screen-body">
                    <p>Ой, быт оказался коварнее..</p>
                </div>                
            </div>        
            
            <div class="button-right">            
                <button id="exit-game-lose" class="button-common button-common-280-red">Попробовать снова</button>            
            </div>
        </div>
    </div>

</div>


<script>
let isMusicPlay = true;

let timerInterval = null;
const SECONDS_FOR_ONE_GAME = 50;

let audioMain = document.getElementById("audioMain");
let audioWin = document.getElementById("audioWin");
let audioTenQuestion = document.getElementById("audioTenQuestion");

document.addEventListener('DOMContentLoaded', () => {
    const portraitContainer = document.querySelector('#portrait-container');
    const landscapeContainer = document.querySelector('#landscape-container');

    // Функция для смены ориентации
    function handleOrientationChange() {
        if (window.matchMedia("(orientation: portrait)").matches) {
            portraitContainer.classList.remove('hidden');
            landscapeContainer.classList.add('hidden');
        } else {
            portraitContainer.classList.add('hidden');
            landscapeContainer.classList.remove('hidden');
        }
    }

    // Регистрация прослушивания изменений ориентации
    window.addEventListener('resize', handleOrientationChange);
});

document.addEventListener('DOMContentLoaded', () => {
    const toggleButton = document.querySelector('#toggle-button');
    let isPortraitMode = false;

    toggleButton.addEventListener('click', () => {
        const portraitContainer = document.querySelector('#portrait-container');
        const landscapeContainer = document.querySelector('#landscape-container');

        if (isPortraitMode) {
            portraitContainer.classList.remove('hidden');
            landscapeContainer.classList.add('hidden');
            isPortraitMode = false;
        } else {
            portraitContainer.classList.add('hidden');
            landscapeContainer.classList.remove('hidden');
            isPortraitMode = true;
        }
    });
});

document.getElementById('start-game').addEventListener('click', showTurnWarningScreen);
document.getElementById('start-game2').addEventListener('click', showTurnWarningScreen);
document.getElementById('continue-game').addEventListener('click', startGameScreen);


document.getElementById('show-rules').addEventListener('click', showRules);
document.getElementById('music-off').addEventListener('click', switchMusic);
document.getElementById('timer').textContent = SECONDS_FOR_ONE_GAME;
/*document.getElementById('jump_button_id').addEventListener('click', heroJump);*/
/*document.getElementById('shopping_button_id').addEventListener('click', goShoping);*/

document.getElementById("exit-game-lose").addEventListener("click", function () {
    //тут нужно закрывать игру с призом NONE
    hideDialog()
});

    function showTurnWarningScreen() {
        document.getElementById("turn_screen_id").style.display = "block";
        document.getElementById('start-screen-id').style.display = "none";
        document.getElementById('rules-screen-id').style.display = "none";                
        audioMain.volume = 0.2;
        audioWin.volume = 0.2;
        audioTenQuestion.volume = 0.2;
        audioMain.play();               
    }
       
    function startGameScreen() {
        document.getElementById("game_screen_id").style.display = "block";
        document.getElementById('start-screen-id').style.display = "none";
        document.getElementById("turn_screen_id").style.display = "none";
        document.getElementById('rules-screen-id').style.display = "none";                
        audioMain.volume = 0.2;
        audioWin.volume = 0.2;
        audioTenQuestion.volume = 0.2;
        audioMain.play();     
        startGame()  
        /*startTimer()*/
    }

    function showRules() {
        document.getElementById("rules-screen-id").style.display = "block";
        document.getElementById('start-screen-id').style.display = "none";        
        audioMain.volume = 0.2;
        audioWin.volume = 0.2;
        audioTenQuestion.volume = 0.2;
        audioMain.play();               
    }    
    
    function resetTimerForNextQuestion() {        
        document.getElementById('timer').innerText = SECONDS_FOR_ONE_GAME;
        clearInterval(timerInterval);
        timerInterval = null
    }       

    function switchMusic() {
    if (isMusicPlay) {
        audioMain.pause();
        document.getElementById("music-icon").src = "pic/sound_pic_off.png";        
        isMusicPlay = false;
    } else {
        audioMain.play();
        document.getElementById("music-icon").src = "pic/sound_on.png";                
        isMusicPlay = true;
    }    
    }  
    
 
// Скрытие модального окна
    function hideDialog() {
    document.getElementById('сongratulations-dialogue').style.display = "none";    
    document.getElementById('losegame').style.display = "none";    
    document.getElementById("game_screen_id").style.display = "block";    
    }

</script>

<script>
    const gameScreen = document.getElementById("game_screen_id");
    const heroContainer = document.getElementById("hero_id");
    const enemyContainer = document.getElementById("enemy_id");
    const timerText = document.getElementById("timer");
    const musicOffBtn = document.getElementById("music-off");
    const shoppingBtn = document.getElementById("shopping_button_id");
    const jumpBtn = document.getElementById("jump_button_id");

    let isJumping = false;    
    let heroBottomOffset = 0;
    let remainingTime = 60; // Игровая продолжительность 1 мин
    let gameInterval;

    let enemiesList = [
    { type: 'man', speed: 3, height: 10, image: 'pic/man.png' },
    { type: 'elderSon', speed: 6, height: 8, image: 'pic/big_sun.png' },
    { type: 'youngerSon', speed: 7, height: 6, image: 'pic/little_sun.png' },
    { type: 'daughter', speed: 5, height: 3, image: 'pic/daughter.png' },
    { type: 'fish', speed: 8, height: 2, image: 'pic/fish.png' },
    { type: 'cat', speed: 10, height: 1, image: 'pic/cat.png' }
    ];
  

    // Ищем индекс элемента 'man' в массиве
    let currentEnemyIndex = enemiesList.findIndex(enemy => enemy.type === 'man');
    
    if (currentEnemyIndex === -1) {
        currentEnemyIndex = 0;
    }

    // Начинаем игру
    function startGame() {
        resetGame();
        gameInterval = setInterval(updateGameState, 200);
        startTimer()
    }

    // Завершение игры
    function endGame() {
        clearInterval(gameInterval);
        showWinScreen()
    }

    function startTimer() {
        let timeLeft = SECONDS_FOR_ONE_GAME;                
            if (!timerInterval) {
                timerInterval = setInterval(() => {
                    if (timeLeft > 0) {
                        timeLeft--;
                        document.getElementById('timer').innerText = timeLeft;                        
                    } else {
                        resetGame()
                        showWinScreen()
                    }
                }, 1000);
            }            
        }

    // Основные игровые процессы
    function updateGameState() {        
        
        // Перемещение врага
        enemyContainer.style.left = `${enemiesList[currentEnemyIndex].speed += 2}%`;

        // Проверка достижения конца экрана
        if (parseInt(enemyContainer.style.left.split("%")[0]) >= 100) {
            changeEnemy(); // Заменяем врага на следующего
        }

        // Обработка прыжков
            if (isJumping) {
                heroBottomOffset += 12;
                heroContainer.style.bottom = `${heroBottomOffset}px`;
                setTimeout(() => {
                    heroBottomOffset -= 12;
                    heroContainer.style.bottom = `${heroBottomOffset}px`;
                    isJumping = false;
                }, 1000);
            }

            // Обнаружение столкновения
            /*
            if (
                parseInt(enemyContainer.style.left.split("%")[0]) >
                (parseInt(heroContainer.style.right.split("%")[0]) || 0)
            ) {
                alert("Вы столкнулись с врагом! Игра закончена.");
                endGame();
            }
                */
        }

        // Реакция на клик кнопки прыжка
        jumpBtn.onclick = () => {
            if (!isJumping) {
                isJumping = true;
            }
        };

        // Переход на шопинг
        shoppingBtn.onclick = () => {            
            heroContainer.classList.add("oops");
            setTimeout(() => {
                heroContainer.classList.remove("oops");
            }, 5000);
        };

        function changeEnemy() {
            currentEnemyIndex = (currentEnemyIndex + 1) % enemiesList.length;
            let newEnemy = enemiesList[currentEnemyIndex];
            enemyContainer.style.left = "0%"; // Возвращаем врага в начало
            /*enemyContainer.style.bottom = `${canvas.height - newEnemy.height}px`; // Устанавливаем новую высоту*/
            enemySpeed = newEnemy.speed; // Устанавливаем новую скорость 
            document.getElementById("enemy_pic_id").src = newEnemy.image;           

            
            
        }

        // Сброс состояния игры
        function resetGame() {
            isJumping = false;
            enemySpeed = 1;
            heroBottomOffset = 0;
            remainingTime = 60;
            heroContainer.style.bottom = "0px";
            enemyContainer.style.left = "0%";
        }
        
        function showWinScreen() {        
        audioMain.pause()  
        audioTenQuestion.pause()                      
        audioWin.play()
        document.getElementById("game_screen_id").style.display = "none";
        document.getElementById("сongratulations-dialogue").style.display = "block";        
        }

    </script>

<script>
    let tg = window.Telegram.WebApp; //получаем объект webapp телеграма 
    tg.expand(); //расширяем на все окно     
          
    document.getElementById('exit-game-lose').addEventListener('click', function(){
      tg.sendData("0");      
    });   

    document.getElementById('exit-game-win').addEventListener('click', function(){
      tg.sendData("1");      
    });       
    
 </script>
</body>
</html>